!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t["binack-browser"]=t["binack-browser"]||{},t["binack-browser"].js=e())}(this,function(){"use strict";var p="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,e){return t(e={exports:{}},e.exports),e.exports}var u=e(function(t,e){var o=p&&p.__assign||function(){return(o=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a,n,i={app:"",sample:10,nick:"",host:"/a.png?"};(n=a=e.EAck||(e.EAck={})).READY="rdy",n.POINT="pnt",n.ERROR="err",n.API="api",n.COUNT="cnt",n.STATISTIC="sta",n.LOG="log";var r=Date.now?Date.now:function(){return+new Date},s=1e3,c=r(),u=function(){function t(t){this.options=o({},i),this.setOptions(t),this.startTime=c}return t.prototype.init=function(){this.ackQueue=[]},t.prototype.setOptions=function(t){for(var e in t)t.hasOwnProperty(e)&&(this.options[e]=t[e])},t.prototype.ackPoint=function(t){var e=r()-this.startTime;this.ack({_ack:a.POINT,point:t,time:e},!1,1)},t.prototype.ackError=function(t,e,n){t.length>s&&(t=t.substring(0,s)),e=e||"sys",n?(n.stack&&n.stack.length>s&&(n.stack=n.stack.substring(0,s)),this.ack(o({_ack:a.ERROR,msg:t,type:e},n),!1,1)):this.ack({_ack:a.ERROR,msg:t,type:e},!1,1)},t.prototype.ackApi=function(t,e,n,o,i){var r={_ack:a.API,api:t,succeed:e};void 0!==n&&(r.cost=n),void 0!==o&&(r.code=o),void 0!==i&&(r.detail=i),this.ack(r,!1,1)},t.prototype.ackCount=function(t){this.ack({_ack:a.COUNT,name:t})},t.prototype.ackStatistic=function(t,e){this.ack({_ack:a.STATISTIC,name:t,value:e})},t.prototype.ackLog=function(t){this.ack({_ack:a.LOG,msg:t},!1,1)},t.prototype.ack=function(t,e,n){var o=this;if(this.options.app)if(t._app=this.options.app,t._time=r(),this.options.nick&&(t._nick=this.options.nick),e)this.send(t);else{if(t._ack===a.ERROR&&"sys"===t.type&&0<this.ackQueue.length){var i=this.ackQueue[this.ackQueue.length-1];if(i._ack===a.ERROR&&"sys"===i.type&&i.message===t.message)return}1!==(n=n||this.options.sample||1)&&1!==Math.floor(Math.random()*n)||(this.ackQueue.push(t),this.ackTimer||(this.ackTimer=setTimeout(function(){o.ackTimer=0,o.flushAckQueue()})))}},t.prototype.ready=function(){this.ackReady()},t.prototype.flushAckQueue=function(){var t=this.ackQueue;this.ackQueue=[];for(var e=0,n=t.length;e<n;++e)this.send(t[e]);this.ackTimer&&(clearTimeout(this.ackTimer),this.ackTimer=0)},t}();e.default=u});t(u);u.EAck;var i=e(function(t,e){var o,n=p&&p.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.init=function(){t.prototype.init.call(this);var e=this.startTime;try{this.startTime=performance.timing.fetchStart||e}catch(t){this.startTime=e}this.imgId=0,this.imgs={},this.hookGlobalError(),this.hookReady(),this.hookUnload()},e.prototype.ackReady=function(){try{var t={RRT:["requestStart","responseStart"],DNS:["domainLookupStart","domainLookupEnd"],CNT:["connectStart","connectEnd"],TTFB:["fetchStart","responseStart"],DLD:["fetchStart","domContentLoadedEventStart"],FLD:["fetchStart","loadEventStart"]},e=performance.timing,n={_ack:u.EAck.READY};for(var o in t)if(t.hasOwnProperty(o)){var i=t[o],r=e[i[0]],a=e[i[1]];if(r&&a){var s=a-r;0<=s&&s<864e5&&(n[o]=s)}}var c=window.navigator.connection;c&&(n.NT=c.effectiveType||c.type||""),this.ack(n,!0)}catch(a){}},e.prototype.send=function(t){var e=this,n=++this.imgId,o=new Image;(this.imgs[n]=o).onload=o.onerror=function(){e.imgs[n]=void 0,delete e.imgs[n]};var i=this.options,r=this.genQueryString(t);o.src=i.host+r},e.prototype.hookGlobalError=function(){var a=this;this.on("error",function(t){if(t&&t.message){var e=t.message,n=t.filename,o=t.lineno,i=t.colno,r=t.error;"string"==typeof e&&(n?a.ackError(e,"sys",{file:n,line:o,column:i,stack:r&&r.stack||""}):a.ackError(e,"sys"))}}),this.on("unhandledrejection",function(t){var e=t.reason;if(e&&e.message){var n=e.message,o=e.stack||"";a.ackError(n,"sys",{file:location.href,line:-1,column:-1,stack:o})}})},e.prototype.hookReady=function(){var t=this;if("complete"!==document.readyState){var e=function(){document.addEventListener?document.removeEventListener("DOMContentLoaded",e,!1):document.attachEvent&&document.detachEvent("onreadystatechange",e),t.ready()};document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):document.attachEvent&&document.attachEvent("onreadystatechange",e)}else this.ready()},e.prototype.hookUnload=function(){var t=this;this.on("beforeunload",function(){t.flushAckQueue()})},e.prototype.genQueryString=function(t){var e=[];try{for(var n in t)if(t.hasOwnProperty(n)){var o=t[n];o="_app"===n?encodeURI(o):encodeURIComponent(o),e.push(n+"="+o)}}catch(t){}return e.join("&")},e.prototype.on=function(t,e,n){window.addEventListener?window.addEventListener(t,e,n):window.attachEvent&&window.attachEvent("on"+t,e)},e}(u.default);e.default=i});return t(i),t(e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=window.__BAck;if(n){var o=new i.default(n);o.init(),window.__BAck=o}}))});
