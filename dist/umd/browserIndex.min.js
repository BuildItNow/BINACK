!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t["binack-browser"]=t["binack-browser"]||{},t["binack-browser"].js=e())}(this,function(){"use strict";var s="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,e){return t(e={exports:{}},e.exports),e.exports}var u=e(function(t,e){var n=s&&s.__assign||function(){return(n=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a,o,i={app:"",sample:10,nick:"",host:"/a.png?"};(o=a=e.EAck||(e.EAck={})).READY="rdy",o.SPEED="spd",o.ERROR="err",o.API="api",o.COUNT="cnt",o.STATISTIC="sta",o.LOG="log";var r=1e3,c=function(){function t(t){this.options=n({},i),this.setOptions(t)}return t.prototype.init=function(){this.ackQueue=[]},t.prototype.setOptions=function(t){for(var e in t)t.hasOwnProperty(e)&&(this.options[e]=t[e])},t.prototype.ackError=function(t,e,o){t.length>r&&(t=t.substring(0,r)),e=e||"sys",o?(o.stack&&o.stack.length>r&&(o.stack=o.stack.substring(0,r)),this.ack(n({_ack:a.ERROR,msg:t,type:e},o),!1,1)):this.ack({_ack:a.ERROR,msg:t,type:e},!1,1)},t.prototype.ackApi=function(t,e,o,n,i){var r={_ack:a.API,api:t,succeed:e};void 0!==o&&(r.cost=o),void 0!==n&&(r.code=n),void 0!==i&&(r.detail=i),this.ack(r,!1,1)},t.prototype.ackCount=function(t){this.ack({_ack:a.COUNT,name:t})},t.prototype.ackStatistic=function(t,e){this.ack({_ack:a.STATISTIC,name:t,value:e})},t.prototype.ackLog=function(t){this.ack({_ack:a.LOG,msg:t},!1,1)},t.prototype.ack=function(t,e,o){var n=this;if(this.options.app)if(t._app=this.options.app,t._time=Date.now(),this.options.nick&&(t._nick=this.options.nick),e)this.send(t);else{if(t._ack===a.ERROR&&"sys"===t.type&&0<this.ackQueue.length){var i=this.ackQueue[this.ackQueue.length-1];if(i._ack===a.ERROR&&"sys"===i.type&&i.message===t.message)return}1!==(o=o||this.options.sample||1)&&1!==Math.floor(Math.random()*o)||(this.ackQueue.push(t),this.ackTimer||(this.ackTimer=setTimeout(function(){n.ackTimer=0,n.flushAckQueue()})))}},t.prototype.ready=function(){this.ackReady()},t.prototype.flushAckQueue=function(){var t=this.ackQueue;this.ackQueue=[];for(var e=0,o=t.length;e<o;++e)this.send(t[e]);this.ackTimer&&(clearTimeout(this.ackTimer),this.ackTimer=0)},t}();e.default=c});t(u);u.EAck;var i=e(function(t,e){var n,o=s&&s.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.imgId=0,this.imgs={},this.hookGlobalError(),this.hookReady(),this.hookUnload()},e.prototype.ackReady=function(){try{var t={RRT:["requestStart","responseStart"],DNS:["domainLookupStart","domainLookupEnd"],CNT:["connectStart","connectEnd"],TTFB:["fetchStart","responseStart"],DLD:["fetchStart","domContentLoadedEventStart"],FLD:["fetchStart","loadEventStart"]},e=performance.timing,o={_ack:u.EAck.READY};for(var n in t)if(t.hasOwnProperty(n)){var i=t[n],r=e[i[0]],a=e[i[1]];if(r&&a){var c=a-r;0<=c&&c<864e5&&(o[n]=c)}}var s=window.navigator.connection;s&&(o.NT=s.effectiveType||s.type||""),this.ack(o,!0)}catch(a){}},e.prototype.send=function(t){var e=this,o=++this.imgId,n=new Image;(this.imgs[o]=n).onload=n.onerror=function(){e.imgs[o]=void 0,delete e.imgs[o]};var i=this.options,r=this.genQueryString(t);n.src=i.host+r},e.prototype.hookGlobalError=function(){var c=window.onerror,s=this;window.onerror=function(t,e,o,n,i){if(c&&c.apply(this,arguments),t){try{var r=typeof t;if("object"===r&&t.message){var a=t;t=a.message,e=e||a.filename,o=o||a.lineno,n=n||a.colno}else"object"===r&&(t=JSON.stringify(t))}catch(t){}"string"==typeof t&&(e?s.ackError(t,"sys",{file:e,line:o,column:n,stack:i&&i.stack||""}):s.ackError(t,"sys"))}}},e.prototype.hookReady=function(){var t=this;if("complete"!==document.readyState){var e=function(){document.addEventListener?document.removeEventListener("DOMContentLoaded",e,!1):document.attachEvent&&document.detachEvent("onreadystatechange",e),t.ready()};document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):document.attachEvent&&document.attachEvent("onreadystatechange",e)}else this.ready()},e.prototype.hookUnload=function(){var t=this,e=function(){t.flushAckQueue()};window.addEventListener?window.addEventListener("beforeunload",e,!1):window.attachEvent&&window.attachEvent("onbeforeunload",e)},e.prototype.genQueryString=function(t){var e=[];try{for(var o in t)if(t.hasOwnProperty(o)){var n=t[o];n="_app"===o?encodeURI(n):encodeURIComponent(n),e.push(o+"="+n)}}catch(t){}return e.join("&")},e}(u.default);e.default=i});return t(i),t(e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var o=window.__BAck;if(o){var n=new i.default(o);n.init(),window.__BAck=n}}))});
